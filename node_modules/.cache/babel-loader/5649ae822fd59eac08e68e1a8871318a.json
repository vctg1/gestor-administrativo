{"ast":null,"code":"var _jsxFileName = \"/home/victorgm1/Documents/cened/gestor-administrativo/src/contexts/JWTAuth.jsx\",\n    _s = $RefreshSig$();\n\nimport LoadingScreen from \"components/LoadingScreen\";\nimport jwtDecode from \"jwt-decode\";\nimport { createContext, useEffect, useReducer } from \"react\";\nimport axios from \"../utils/axios\"; // --------------------------------------------------------\n// --------------------------------------------------------\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialState = {\n  isAuthenticated: false,\n  isInitialized: false,\n  user: null\n};\n\nconst isValidToken = accessToken => {\n  if (!accessToken) return false;\n  const decodedToken = jwtDecode(accessToken);\n  const currentTime = Date.now() / 1000;\n  return decodedToken.exp > currentTime;\n};\n\nconst setSession = accessToken => {\n  if (accessToken) {\n    // localStorage.setItem('accessToken', accessToken);\n    axios.defaults.headers.common.Authorization = `Bearer ${accessToken}`;\n  } else {\n    // localStorage.removeItem('accessToken');\n    delete axios.defaults.headers.common.Authorization;\n  }\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case \"INIT\":\n      {\n        return {\n          isInitialized: true,\n          user: action.payload.user,\n          isAuthenticated: action.payload.isAuthenticated\n        };\n      }\n\n    case \"LOGIN\":\n      {\n        return { ...state,\n          isAuthenticated: true,\n          user: action.payload.user\n        };\n      }\n\n    case \"LOGOUT\":\n      {\n        return { ...state,\n          user: null,\n          isAuthenticated: false\n        };\n      }\n\n    case \"REGISTER\":\n      {\n        return { ...state,\n          isAuthenticated: true,\n          user: action.payload.user\n        };\n      }\n\n    default:\n      {\n        return state;\n      }\n  }\n};\n\nconst AuthContext = /*#__PURE__*/createContext({ ...initialState,\n  method: \"JWT\",\n  logout: () => {},\n  login: (email, password) => Promise.resolve(),\n  register: (email, password, username) => Promise.resolve()\n});\nexport const JWTAuthProvider = _ref => {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  const login = async (email, password) => {\n    const {\n      data\n    } = await axios.post(\"/api/auth/login\", {\n      email,\n      password\n    });\n    setSession(data.accessToken);\n    dispatch({\n      type: \"LOGIN\",\n      payload: {\n        user: data.user\n      }\n    });\n  };\n\n  const register = async (email, username, password) => {\n    const {\n      data\n    } = await axios.post(\"/api/auth/register\", {\n      email,\n      username,\n      password\n    });\n    setSession(data.accessToken);\n    dispatch({\n      type: \"REGISTER\",\n      payload: {\n        user: data.user\n      }\n    });\n  };\n\n  const logout = () => {\n    setSession(null);\n    dispatch({\n      type: \"LOGOUT\"\n    });\n  };\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const accessToken = localStorage.getItem(\"accessToken\");\n\n        if (accessToken && isValidToken(accessToken)) {\n          setSession(accessToken);\n          const {\n            data\n          } = await axios.get(\"/api/auth/profile\");\n          dispatch({\n            type: \"INIT\",\n            payload: {\n              user: data.user,\n              isAuthenticated: true\n            }\n          });\n        } else {\n          dispatch({\n            type: \"INIT\",\n            payload: {\n              user: null,\n              isAuthenticated: false\n            }\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        dispatch({\n          type: \"INIT\",\n          payload: {\n            user: null,\n            isAuthenticated: false\n          }\n        });\n      }\n    })();\n  }, []); // show loading until not initialized\n\n  if (!state.isInitialized) /*#__PURE__*/_jsxDEV(LoadingScreen, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 141,\n    columnNumber: 29\n  }, this);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: { ...state,\n      method: \"JWT\",\n      login,\n      register,\n      logout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 143,\n    columnNumber: 5\n  }, this);\n};\n\n_s(JWTAuthProvider, \"bgCdjuTOmPdSBRwTap80EFd9Y3U=\");\n\n_c = JWTAuthProvider;\nexport default AuthContext;\n\nvar _c;\n\n$RefreshReg$(_c, \"JWTAuthProvider\");","map":{"version":3,"names":["LoadingScreen","jwtDecode","createContext","useEffect","useReducer","axios","initialState","isAuthenticated","isInitialized","user","isValidToken","accessToken","decodedToken","currentTime","Date","now","exp","setSession","defaults","headers","common","Authorization","reducer","state","action","type","payload","AuthContext","method","logout","login","email","password","Promise","resolve","register","username","JWTAuthProvider","children","dispatch","data","post","localStorage","getItem","get","err","console","error"],"sources":["/home/victorgm1/Documents/cened/gestor-administrativo/src/contexts/JWTAuth.jsx"],"sourcesContent":["import LoadingScreen from \"components/LoadingScreen\";\nimport jwtDecode from \"jwt-decode\";\nimport { createContext, useEffect, useReducer } from \"react\";\nimport axios from \"../utils/axios\"; // --------------------------------------------------------\n\n// --------------------------------------------------------\nconst initialState = {\n  isAuthenticated: false,\n  isInitialized: false,\n  user: null,\n};\n\nconst isValidToken = (accessToken) => {\n  if (!accessToken) return false;\n  const decodedToken = jwtDecode(accessToken);\n  const currentTime = Date.now() / 1000;\n  return decodedToken.exp > currentTime;\n};\n\nconst setSession = (accessToken) => {\n  if (accessToken) {\n    // localStorage.setItem('accessToken', accessToken);\n    axios.defaults.headers.common.Authorization = `Bearer ${accessToken}`;\n  } else {\n    // localStorage.removeItem('accessToken');\n    delete axios.defaults.headers.common.Authorization;\n  }\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case \"INIT\": {\n      return {\n        isInitialized: true,\n        user: action.payload.user,\n        isAuthenticated: action.payload.isAuthenticated,\n      };\n    }\n\n    case \"LOGIN\": {\n      return { ...state, isAuthenticated: true, user: action.payload.user };\n    }\n\n    case \"LOGOUT\": {\n      return { ...state, user: null, isAuthenticated: false };\n    }\n\n    case \"REGISTER\": {\n      return { ...state, isAuthenticated: true, user: action.payload.user };\n    }\n\n    default: {\n      return state;\n    }\n  }\n};\n\nconst AuthContext = createContext({\n  ...initialState,\n  method: \"JWT\",\n  logout: () => {},\n  login: (email, password) => Promise.resolve(),\n  register: (email, password, username) => Promise.resolve(),\n});\nexport const JWTAuthProvider = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  const login = async (email, password) => {\n    const { data } = await axios.post(\"/api/auth/login\", {\n      email,\n      password,\n    });\n    setSession(data.accessToken);\n    dispatch({\n      type: \"LOGIN\",\n      payload: {\n        user: data.user,\n      },\n    });\n  };\n\n  const register = async (email, username, password) => {\n    const { data } = await axios.post(\"/api/auth/register\", {\n      email,\n      username,\n      password,\n    });\n    setSession(data.accessToken);\n    dispatch({\n      type: \"REGISTER\",\n      payload: {\n        user: data.user,\n      },\n    });\n  };\n\n  const logout = () => {\n    setSession(null);\n    dispatch({\n      type: \"LOGOUT\",\n    });\n  };\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const accessToken = localStorage.getItem(\"accessToken\");\n\n        if (accessToken && isValidToken(accessToken)) {\n          setSession(accessToken);\n          const { data } = await axios.get(\"/api/auth/profile\");\n          dispatch({\n            type: \"INIT\",\n            payload: {\n              user: data.user,\n              isAuthenticated: true,\n            },\n          });\n        } else {\n          dispatch({\n            type: \"INIT\",\n            payload: {\n              user: null,\n              isAuthenticated: false,\n            },\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        dispatch({\n          type: \"INIT\",\n          payload: {\n            user: null,\n            isAuthenticated: false,\n          },\n        });\n      }\n    })();\n  }, []); // show loading until not initialized\n\n  if (!state.isInitialized) <LoadingScreen />;\n  return (\n    <AuthContext.Provider\n      value={{ ...state, method: \"JWT\", login, register, logout }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\nexport default AuthContext;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}